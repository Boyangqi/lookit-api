{% extends 'exp/base.html' %}
{% load bootstrap3 %}
{% load exp_extras %}

{% block title %}All Responses | {{ study.name }}{% endblock %}
{% block head %}
    {{ block.super }}
    {{ form.media }}
{% endblock %}

{% block flash %}
  {% bootstrap_messages %}
  {% if form.non_field_errors %}
  <div class="alert alert-danger" role="alert">
      {{ form.non_field_errors }}
  </div>
  {% endif %}
{% endblock %}

{% block content %}
<div class='container mb-lg'>
    <div class='row'>
        <div class="col-xs-12">
            <ol class="breadcrumb">
              <li><a href="{% url 'exp:study-list' %}">Manage Studies</a></li>
              <li><a href="{% url 'exp:study-detail' pk=study.id %}"> {{ study.name }}</a></li>
              <li class="active"> {{ active_tab }} </li>
            </ol>
        </div>
    </div>
    <div class='row'>
        <div class="col-xs-12">
            <h1>All Responses</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
        	{% include 'studies/_response_nav_tabs.html' with active=active %}
        </div>
    </div>
	{% if n_responses %}
        <div class='row pt-xl all-responses'>
            
            <div class="col-xs-12 col-lg-10">
                {% if active == 'all' %}
                    <p> Download data about {{ n_responses }} response{{ n_responses|pluralize}}: </p>
                    
                    <hr>
                    <div class="row">
                        <div class="col-md-7 col-sm-6">
                            All response data 
                            <p class="help-text"> The true "raw" data is most naturally represented in JSON format, a structured format that allows nesting (for instance, you might see a question1 field inside formData inside parent-survey). This file contains a list of all responses to your study; each response has basic information about the participant, account, and consent coding as well as what happened during the study.</p>
                        </div>
                        <div class="col-md-5 col-sm-6">
                            <div class='pull-right download-button'> 
                                Data 
                                <a id='download-all-data-json' class ='btn btn-primary pull-right' href="{% url 'exp:study-responses-download-json' pk=study.id %}">
                                    <span> <i class="fa fa-download"></i> (JSON) </span>
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-7 col-sm-6">
                            Response overview
                            <p class="help-text"> The response overview file gives high-level information about each response - the account and child IDs, consent approval information, condition assignment, and information about the child such as gender and languages spoken. There is one row per response. This can be used in conjunction with frame data (below) to avoid having to parse JSON in your analysis.</p>
                        </div>
                        <div class="col-md-5 col-sm-6">
                            <div class='pull-right download-button'> 
                                Data  
                                <a id='download-all-data-csv' class='btn btn-primary' href="{% url 'exp:study-responses-download-csv' pk=study.id %}">
                                    <span><i class="fa fa-download"></i> (CSV)</span>
                                </a>
                            </div>
                            <div class='pull-right download-button'> 
                                Data dictionary 
                                <a id='download-data-dict-csv' class='btn btn-primary' href="{% url 'exp:study-responses-download-summary-dict-csv' pk=study.id %}">
                                    <span> <i class="fa fa-download"></i> (CSV)</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-7 col-sm-6">
                            Frame data
                            <p class="help-text"> The frame data files include all of the information captured by the individual frames of your experiment: for instance, text and selections on forms, which option a participant clicked during a forced-choice trial, and events such as entering or leaving fullscreen, pausing the study, or pressing buttons. These data are shown in a "long" format, with one row per datum and columns for the key and value.</p>
                        </div>
                        <div class="col-md-5 col-sm-6">
                            <div class='pull-right download-button'> 
                                Data (all responses)
                                <a id='download-frame-data-csv' class='btn btn-primary' href="{% url 'exp:study-responses-download-frame-data-csv' pk=study.id %}">
                                    <span> <i class="fa fa-download"></i> (CSV)</span>
                                </a>
                            </div>
                            <div class='pull-right download-button'> 
                                Data (one file per response)
                                <a id='download-frame-data-csv' class='btn btn-primary' href="{% url 'exp:study-responses-download-frame-data-zip-csv' pk=study.id %}">
                                    <span> <i class="fa fa-download"></i> (ZIP, CSVs)</span>
                                </a>
                            </div>
                            <div class='pull-right download-button'> 
                                Data dictionary 
                                <a id='download-frame-dict-csv' class='btn btn-primary' href="{% url 'exp:study-responses-download-frame-data-dict-csv' pk=study.id %}">
                                    <span> <i class="fa fa-download"></i> (CSV)</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    
                {% endif %}
                {% if active == 'demographics' %}
                    <a id='download-all-data-json' class ='btn btn-primary' href="{% url 'exp:study-demographics-download-json' pk=study.id %}">
                        Download all {{ n_responses }} demographic snapshot{{ n_responses|pluralize }} as JSON</span>
                    </a>
                    <a id='download-all-data-csv' class='hidden btn btn-primary' href="{% url 'exp:study-demographics-download-csv' pk=study.id %}">
                        Download all {{ n_responses }} demographic snapshot{{ n_responses|pluralize }} as CSV</span>
                    </a>
                {% endif %}
            </div>
        </div>
    {% else %}
    	<div class="row">
    		<div class="col-xs-12">
    			<p class="pt-md"><em>No responses with confirmed consent.</em></p>
    		</div>
    	</div>
    {% endif %}
</div>
{% endblock %}
