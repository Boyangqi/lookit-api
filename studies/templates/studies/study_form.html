{% extends 'exp/base.html' %}
{% load bootstrap3 %}

{% block title %}Create Study{% endblock %}
{% block head %}
    {{ block.super }}
    <script type="application/javascript">
        /* Fix for ace-editor. It thinks it's in the admin only */
        (function (){
            if (window.jQuery !== undefined) {
                window.django = {
                    'jQuery': window.jQuery
                };
            }
        })();
    </script>
    <script>
        $(document).ready(function(){
            document.getElementById("id_study_type").value = '';
            $('#study-type-metadata').hide()
            $('.type-fields > .form-group > input').prop("disabled", true);
            $('form').submit(function() {
                $('#create-study-button').prop("disabled", "disabled");
            });
            $('#id_study_type').on('change', function(selected) {
                if (selected.currentTarget.value) {
                    var selectedVal = parseInt(selected.currentTarget.value);
                    $('#study-type-metadata').show();
                    $('.type-fields').hide();
                    $('.type-fields > .form-group > input').attr("disabled", true);
                    $(`#type-metadata-${selectedVal}> .form-group > input`).prop("disabled", false);
                    $(`#type-metadata-${selectedVal}`).show();
                } else {
                    $('#study-type-metadata').hide()
                    $('.type-fields > .form-group > input').prop("disabled", true);
                }
            });
        });
    </script>
    {{ form.media }}
{% endblock %}

{% block content %}
  <div class="container">
    <div class="row">
        <div class="col-xs-12">
            <ol class="breadcrumb">
              <li><a href="{% url 'exp:study-list' %}"> Manage Studies </a></li>
              <li class="active">Create Study</li>
            </ol>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-xs-offset-0 col-md-10 col-md-offset-1">
            <div class="panel panel-default mt-md">
              <div class="panel-heading">
                <h1 class="panel-title">Create Study</h1>
              </div>
              <div class="panel-body">
                <form action="" enctype="multipart/form-data" method="post">{% csrf_token %}
                    {% bootstrap_form_errors form %}
                    {% bootstrap_field form.name %}
                    {% bootstrap_field form.image %}
                    {% bootstrap_field form.short_description %}
                    {% bootstrap_field form.long_description %}
                    {% bootstrap_field form.exit_url %}
                    {% bootstrap_field form.criteria %}
                    <div class="row">
                        <div class="col-xs-12">
                            <label class="control-label">Minimum Age Cutoff</label>
                        </DIV>
                        <div class="col-xs-2">
                            <div class="form-group">
                                <label class="control-label" for="id_min_age_years"><em>Year(s)</em></label>
                                <select name="min_age_years" class="form-control" title="" id="id_min_age_years">
                                    <option value="0" selected="">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-xs-2">
                            <div class="form-group">
                                <label class="control-label" for="id_min_age_months"><em>Month(s)</em></label>
                                <select class="form-control" id="id_min_age_months" name="min_age_months" title="">
                                    <option selected value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <label class="control-label">Maximum Age Cutoff</label>
                        </div>
                        <div class="col-xs-2">
                            <div class="form-group">
                                <label class="control-label" for="id_max_age_years"><em>Year(s)</em></label>
                                <select name="max_age_years" class="form-control" title="" id="id_max_age_years">
                                    <option value="0" selected="">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-xs-2">
                            <div class="form-group">
                                <label class="control-label" for="id_max_age_months"><em>Month(s)</em></label>
                                <select class="form-control" id="id_max_age_months" name="max_age_months" title="">
                                    <option selected value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    {% bootstrap_field form.duration %}
                    {% bootstrap_field form.contact_info %}
                    {% bootstrap_field form.public %}
                    {% bootstrap_field form.structure %}
                    {% bootstrap_field form.study_type %}
                    {% include "studies/_study_type.html" with types=types create=1 %}

                    <div class="pull-right">
                        {% buttons %}
                            <a href="{% url 'exp:study-list' %}" class="btn btn-default">
                                Cancel
                            </a>
                            <button type="submit" id="create-study-button" class="btn btn-success">
                                {% bootstrap_icon "plus" %} Create Study
                            </button>
                        {% endbuttons %}
                    </div>
                </form>
            </div>
          </div>
        </div>
    </div>
  </div>
{% endblock %}
